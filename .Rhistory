paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
data_files <- list.files(
path = 'data/birthday_box_scores/',
pattern = '.csv',
full.names = FALSE,
ignore.case = FALSE
)
birthday_df <- data.frame()
for (data_file in data_files[1:2]) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
data_files[1]
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_files[1]),
show_col_types = FALSE
)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
raw_df
library(tidyverse)
library(ggplot2)
library(lubridate)
library(scales)
library(Lahman)
library(baseballr)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
rlang::last_trace()
names(raw_df)
birthdays_augm <- birthday_hits %>%
left_join(in_season_birthdays,
by = c('player_id' = 'MLBID')
)
birthdays_augm
birthdays_augm %>%
filter(intentional_walks > 0) %>%
select(nameFirst, nameLast, base_on_balls, intentional_walks) %>%
print(n = 10)
birthday_df <- data.frame()
for (data_file in data_files[1:2]) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
print(data_file)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
hitting_stats <- c(
'player_id',
'game_pk',
'fly_outs',
'ground_outs',
'runs',
'doubles',
'triples',
'home_runs',
'strike_outs',
'base_on_balls',
'intentional_walks',
'hits',
'hit_by_pitch',
'at_bats',
'ground_into_double_play',
'ground_into_triple_play',
'plate_appearances',
'total_bases',
'rbi',
'left_on_base',
'sac_bunts',
'sac_flies'
)
birthday_df <- data.frame()
for (data_file in data_files[1:2]) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
print(data_file)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
for (data_file in data_files[1:2]) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
print(substr(data_file, 8, 18))
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
for (data_file in data_files[1:20]) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
print(substr(data_file, 8, 17))
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
birthday_df <- data.frame()
for (data_file in data_files[1:20]) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
game_date <- substr(data_file, 8, 17)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
clean_hitter_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
birthday_df %>% select(game_date)
birthday_df <- data.frame()
for (data_file in data_files) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
game_date <- substr(data_file, 8, 17)
clean_hitter_df <- raw_df %>%
filter(group == 'hitting') %>%
select(all_of(hitting_stats))
clean_hitter_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_hitter_df)
}
birthdays_augm <- birthday_df %>%
left_join(in_season_birthdays,
by = c('player_id' = 'MLBID')
)
birthdays_augm %>%
select(nameFirst, nameLast, player_id, hits, plate_appearances) %>%
print(n = 10)
write_csv(birthdays_augm, 'data/cleaned/birthday_hitter_stats.csv')
birthday_hits <- read_csv('data/cleaned/birthday_hitter_stats.csv')
birthday_hits %>%
filter(intentional_walks > 0) %>%
select(nameFirst, nameLast, base_on_balls, intentional_walks) %>%
print(n = 10)
birthday_hits %>%
filter(intentional_walks > 0) %>%
select(nameFirst, nameLast, game_date, base_on_balls, intentional_walks) %>%
print(n = 10)
calculate_obp <- function(hitter_df) {
tot_ob <- sum(hitter_df$hits) +
sum(hitter_df$base_on_balls) +
sum(hitter_df$hit_by_pitch)
tot_pa <- sum(hitter_df$plate_appearances)
obp <- tot_ob / tot_pa
}
calculate_obp(birthday_hits)
calculate_obp <- function(hitter_df) {
tot_ob <- sum(hitter_df$hits) +
sum(hitter_df$base_on_balls) +
sum(hitter_df$hit_by_pitch)
tot_pa <- sum(hitter_df$plate_appearances)
obp <- tot_ob / tot_pa
obp
}
calculate_obp(birthday_hits)
calculate_ba <- function(hitter_df) {
ba <- sum(hitter_df$hits) / sum(hitter_df$at_bats)
ba
}
calculate_ba(birthday_hits)
calculate_slg <- function(hitter_df) {
slg <- sum(hitter_df$total_bases) / sum(hitter_df$at_bats)
slg
}
calculate_slg(birthday_hits)
names(birthday_hits)
head(birthday_hits$game_date)
birthday_hits$game_year <- substr(birthday_hits$game_date, 1, 4)
head(birthday_hits$game_year)
hitters_05 <- read_csv('data/season_data/hitting_stats_2005.csv')
names(hitters_05)
birthday_hits %>% filter(game_year == '2005')
birthday_hits %>% filter(game_year == '2006')
birthday_hits %>% filter(game_year == '2007')
birthday_hits %>% filter(game_year == '2008')
birthday_hits %>% count(game_year)
birthday_hits %>%
filter(game_year == '2005')
birthday_hits %>%
filter(game_year == '2005') %>%
select(player_id, nameFirst, nameLast, hits, at_bats)
names(hitters_05)
112020 %in% hitters_05$player_id
999999 %in% hitters_05$player_id
bh_05 <- birthday_hits %>%
filter(game_year == '2005') %>%
select(player_id, nameFirst, nameLast, hits, at_bats)
hitters_05 %>%
filter(player_id %in% bh_05$player_id)
hitters_05 %>%
filter(player_id %in% bh_05$player_id) %>%
select(player_id, nameFirst)
names(hitters_05)
hitters_05 %>%
filter(player_id %in% bh_05$player_id) %>%
select(player_id, player_full_name, hits_at_bats, avg)
hitters_05 %>%
filter(player_id %in% bh_05$player_id) %>%
select(player_id, player_full_name, hits, at_bats, avg)
unique(birthday_hits$game_year)
unique_years <- unique(birthday_hits$game_year)
head(hitters_05$season)
birthday_boys_season_stats <- data.frame()
for (year_str in unique_years) {
print(year_str)
season_stats_fname <- paste0('data/season_data/hitting_stats_',
year_str,
'.csv')
season_stats_df <- read_csv(season_stats_fname)
players_this_year <- birthday_hits %>%
filter(game_year == year_str) %>%
pull(player_id)
birthday_boys_this_year <- season_stats_df %>%
filter(player_id %in% players_this_year)
birthday_boys_season_stats <- rbind(
birthday_boys_season_stats,
birthday_boys_this_year
)
}
nrow(birthday_hits)
nrow(birthday_boys_season_stats)
head(birthday_boys_season_stats)
birthday_boys_season_stats %>%
select(player_id, season, player_full_name, hits, at_bats) %>%
print(n = 10)
birthday_hits <- read_csv('data/cleaned/birthday_hitter_stats.csv')
birthday_boys_season_stats %>%
select(player_id, season, player_full_name, hits, at_bats) %>%
print(n = 10)
birthdays_slash <- c(
calculate_ba(birthday_hits),
calculate_obp(birthday_hits),
calculate_slg(birthday_hits)
)
birthdays_slash
full_season_slash <- c(
calculate_ba(birthday_boys_season_stats),
calculate_obp(birthday_boys_season_stats),
calculate_slg(birthday_boys_season_stats)
)
full_season_slash
sum(birthday_boys_season_stats$plate_appearances)
sum(birthday_hits$plate_appearances)
library(Lahman)
setwd('baseball/birthdays')
in_season_birthdays <- People %>%
mutate(finalGame = as_date(finalGame)) %>%
filter(finalGame >= as_date('2000-01-01')) %>%
left_join(
select(player_id_map, c('BREFID', 'MLBID')),
by = c('bbrefID' = 'BREFID')
) %>%
filter(birthMonth >= 4 & birthMonth <= 9) %>%
select(playerID, nameFirst, nameLast,
birthDate, birthYear, birthMonth, birthDay,
debut, finalGame,
bbrefID, MLBID) %>%
filter(!is.na(MLBID)) %>%
mutate(debut_year = year(debut), final_year = year(finalGame))
write_csv(in_season_birthdays, 'data/in_season_birthdays.csv')
rm()
library(tidyverse)
library(ggplot2)
library(lubridate)
library(scales)
library(Lahman)
library(baseballr)
setwd('baseball/birthdays')
# see get_in_season_birthdays.R
in_season_birthdays <- read_csv('data/in_season_birthdays.csv')
# get the filenames in the box scores directory
data_files <- list.files(
path = 'data/birthday_box_scores/',
pattern = '.csv',
full.names = FALSE,
ignore.case = FALSE
)
getwd()
getwd() == "/Users/tmurphy5/baseball/birthdays"
"birthdays" %in% getwd()
my_data <- read_csv(data_files[1])
my_data <- read_csv(paste0('data/birthday_box_scores/', data_files[1]))
my_data
names(my_data)
my_data
my_data[2, 'strike_outs']
my_data[3, 'strike_outs']
my_data[3, 'outs']
my_data[2, 'outs']
my_data[2, 'innings_pitched']
# manually found these from the columns in data_files[1]
pitching_stats <- c(
'innings_pitched',
'wins',
'losses',
'saves',
'save_opportunities',
'holds',
'blown_saves',
'earned_runs',
'batters_faced',
'outs',
'games_pitched',
'complete_games',
'shutouts',
'pitches_thrown',
'balls',
'strikes',
'hit_batsmen',
'balks',
'wild_pitches',
'strike_outs',
'runs',
'base_on_balls'
)
# make clean birthday_df with just desired pitching stats
birthday_df <- data.frame()
for (data_file in data_files) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
game_date <- substr(data_file, 8, 17)
clean_pitcher_df <- raw_df %>%
filter(group == 'pitching') %>%
select(all_of(pitching_stats))
clean_pitcher_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_pitcher_df)
}
# make clean birthday_df with just desired pitching stats
birthday_df <- data.frame()
for (data_file in data_files) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
if ('innings_pitched' %in% names(raw_df)) {
game_date <- substr(data_file, 8, 17)
clean_pitcher_df <- raw_df %>%
filter(group == 'pitching') %>%
select(all_of(pitching_stats))
clean_pitcher_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_pitcher_df)
}
}
nrow(birthday_df)
raw_df
game_date
raw_df$player_id[1]
in_season_birthdays %>% filter(player_id == 518586)
in_season_birthdays %>% filter(MLBID == 518586)
# make clean birthday_df with just desired pitching stats
birthday_df <- data.frame()
for (data_file in data_files) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
if ('innings_pitched' %in% names(raw_df)) {
game_date <- substr(data_file, 8, 17)
clean_pitcher_df <- raw_df %>%
filter(group == 'pitching') %>%
select(any_of(pitching_stats))
clean_pitcher_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_pitcher_df)
}
}
game_date
names(raw_df)
pitching_stats_s <- c(
'earned_runs',
'batters_faced',
'outs',
'games_pitched',
'pitches_thrown',
'balls',
'strikes',
'hit_batsmen',
'balks',
'wild_pitches',
'strike_outs',
'runs',
'base_on_balls'
)
# make clean birthday_df with just desired pitching stats
birthday_df <- data.frame()
for (data_file in data_files) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
if ('innings_pitched' %in% names(raw_df)) {
game_date <- substr(data_file, 8, 17)
clean_pitcher_df <- raw_df %>%
filter(group == 'pitching') %>%
select(all_of(pitching_stats_s))
clean_pitcher_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_pitcher_df)
}
}
pitching_stats_s <- c(
'batters_faced',
'outs',
'games_pitched',
'balls',
'strikes',
'hit_batsmen',
'balks',
'wild_pitches',
'strike_outs',
'runs',
'base_on_balls'
)
# make clean birthday_df with just desired pitching stats
birthday_df <- data.frame()
for (data_file in data_files) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
if ('innings_pitched' %in% names(raw_df)) {
game_date <- substr(data_file, 8, 17)
clean_pitcher_df <- raw_df %>%
filter(group == 'pitching') %>%
select(all_of(pitching_stats_s))
clean_pitcher_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_pitcher_df)
}
}
# add bio data for convenience later
birthdays_augm <- birthday_df %>%
left_join(in_season_birthdays,
by = c('player_id' = 'MLBID')
)
pitching_stats_s <- c(
'player_id',
'batters_faced',
'outs',
'games_pitched',
'balls',
'strikes',
'hit_batsmen',
'balks',
'wild_pitches',
'strike_outs',
'runs',
'base_on_balls'
)
# make clean birthday_df with just desired pitching stats
birthday_df <- data.frame()
for (data_file in data_files) {
raw_df <- read_csv(
paste0('data/birthday_box_scores/', data_file),
show_col_types = FALSE
)
if ('innings_pitched' %in% names(raw_df)) {
game_date <- substr(data_file, 8, 17)
clean_pitcher_df <- raw_df %>%
filter(group == 'pitching') %>%
select(all_of(pitching_stats_s))
clean_pitcher_df$game_date <- game_date
birthday_df <- rbind(birthday_df, clean_pitcher_df)
}
}
# add bio data for convenience later
birthdays_augm <- birthday_df %>%
left_join(in_season_birthdays,
by = c('player_id' = 'MLBID')
)
# save clean dataframe
write_csv(birthdays_augm, 'data/cleaned/birthday_pitcher_stats.csv')
nrow(birthday_df)
sum(birthday_df$outs)
sum(is.na(birthday_df$outs))
sum(is.na(birthday_df$strike_outs))
birthday_df <- birthday_df %>% filter(!is.na(outs))
sum(birthday_df$outs)
sum(birthday_df$outs) / 3
sum(birthday_df$outs) / 3 / 9
sum(birthday_df$strike_outs)
sum(birthday_df$runs)
221 / 54.18
